# Java native interface for Finsemble

## Java Recipes
This recipe provides an example to start a Tomcat instance with a Java servlet that connecting to finsemble core.
The webapp contains 2 parts. A jsp page and a java servlet. The jsp page will use the java servlet and the servlet will connect to the finsemble core.

To use this recipe please follow the following steps.
1. Download Tomcat from its website base your environment.
2. Tomcat can be started by Tomcat default scripts or windows service. If you need to start Tomcat by windows service, please install it as windows service in advanced.
3. Add $tomcatPath in manifest.json
4. Copy java-example.json to your seed project and include it in the manifest.json
5. Build this project using maven and copy FinsembleJavaServletExample.war to the webapp folder under your Tomcat directory.
    mvn package
6. Run your seed project.
    npm run dev

Testing
1. Build and run the seed project with the above steps
2. Start Tomcat either by Start Tomcat Script/Start Tomcat Service.
3. A component will automatically display after the Tomcat started.
4. A welcome component can be spawned by clicking the button in the component spawned in step 3.

## Testing in the IDE

The finsemble-jar project must be built before it can be run. 

Pass the following parameters:
```
finsembleWindowName=FinsembleJar-11-126-Finsemble componentType=FinsembleJar uuid=uuid1545252286933_4444 left=316 top=89 width=800 height=600 iac=true serverAddress=ws://127.0.0.1:3376
```

## Maven

You can build the JAR file and the launch4j executable file using the `mvn package` command.

**NOTE:** The executable generated by launch4j is experimental and may not work correctly.

## Testing application from command line

This can be run with the following command from the project root:
``` BASH
./target/FinsembleJavaExample.exe
```

## Configuration for testing 
Copy the _java-example.json_ included in the project to _src/components/java-example/java-example.json_. Update the application manifest to include:
``` JSON
    "finsemble": {
        "applicationRoot": "http://localhost:3375",
        "moduleRoot": "http://localhost:3375/finsemble",
        "servicesRoot": "http://localhost:3375/finsemble/services",
		"notificationURL": "http://localhost:3375/components/notification/notification.html",
		"javaExampleRoot": "<path to finsemble-java-example root>/target",
        "importConfig": [
			"$applicationRoot/configs/application/config.json",
            "$applicationRoot/components/native/java-example.json"
        ],
        "IAC": {
            "serverAddress" : "ws://127.0.0.1:3376"
        }
    }
```

**NOTE:** The _java-example.json_ file includes two components: Java Example (local) and Java Example (asset). The "local" component uses `javaExampleRoot` to specify the path to the JAR file on the local system. The "asset" component uses the `appAsset` (described below) to download and run the application.

## Configuration for asset testing

Copy the _FinsembleJavaExample.zip_ from _target_ to the _hosted_ folder in the seed project. Add the _FinsembleJavaExample.zip_ entry to `appAssets` in _configs/openfin/manifest-local.json_.

``` json
/* ... */
    "appAssets": [
        {
            "src": "https://assets.finsemble.com/assimilation/assimilation_3.10.0.1.zip",
            "version": "3.10.0",
            "alias": "assimilation",
            "target": "AssimilationMain.exe"
        },
        {
            "src": "http://localhost:3375/hosted/FinsembleJavaExample.zip",
            "version": "3.10.0",
            "alias": "finsembleJavaExample",
            "target": "FinsembleJavaExample.exe"
        }
    ],
/* ... */
```


## Enable logging
This project includes an example _logging.properties_ file to enable logging for the project. To use this file, add the following argument to the command line to launch the example (e.g. to the `arguments` property of the component config:
```
-Djava.util.logging.config.file="C:\\Users\\andy\\Documents\\SourceCode\\finsemble-java-example\\logging.properties"
```

So the arguments passed to the Java example will look like:
```
finsembleWindowName=FinsembleJar-11-126-Finsemble componentType=FinsembleJar uuid=uuid1545252286933_4444 left=316 top=89 width=800 height=600 iac=true serverAddress=ws://127.0.0.1:3376 -Djava.util.logging.config.file="C:\\Users\\andy\\Documents\\SourceCode\\finsemble-java-example\\logging.properties"
```

Be sure to update `"java.util.logging.config.file"` to point to the location of the _logging.properties_ file. The provided _logging.properties_ file puts the log in the system temp directory (e.g. _%TEMP%_ on Windows).